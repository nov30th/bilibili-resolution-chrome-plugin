# B站自动最高清晰度 Chrome 插件

## 功能介绍

这是一个用于哔哩哔哩（B站）的Chrome扩展插件，可以在视频加载完成后自动选择最高清晰度。

### 主要特性

- 🎬 **自动选择最高清晰度**：视频加载后自动切换到最高可用画质
- 👑 **会员/非会员模式**：可选择是否使用大会员专属清晰度
- 🔄 **智能重试机制**：如果首次选择失败会自动重试
- 🎯 **手动触发**：支持通过插件弹窗手动选择最高清晰度
- 🎮 **视频切换检测**：在同一页面切换视频时自动重新选择清晰度

## 安装方法

### 步骤 1：生成图标文件

1. 在浏览器中打开 `generate-icons.html` 文件
2. 点击每个canvas画布，下载对应的图标文件：
   - icon16.png
   - icon48.png
   - icon128.png
3. 将下载的图标文件保存到插件根目录

### 步骤 2：加载插件

1. 打开 Chrome 浏览器
2. 在地址栏输入 `chrome://extensions/` 并回车
3. 打开右上角的「开发者模式」开关
4. 点击「加载已解压的扩展程序」按钮
5. 选择本插件所在的文件夹 `bilibili-auto-quality`
6. 插件加载成功后会在扩展程序列表中显示

## 使用方法

### 自动模式

1. 安装插件后，访问任意B站视频页面（如：`https://www.bilibili.com/video/BVxxxxx`）
2. 插件会在视频加载完成后自动选择最高清晰度
3. 查看控制台（F12）可以看到插件的运行日志

### 配置选项

点击浏览器工具栏中的插件图标，打开设置面板：

- **选择会员最高清晰度**：
  - ✅ 开启：选择包括大会员专属清晰度在内的最高画质（如4K、杜比视界等）
  - ❌ 关闭：只选择非会员可用的最高画质（如1080P高清）

### 手动触发

如果自动选择失败或需要重新选择，可以：
1. 点击插件图标打开弹窗
2. 点击「立即选择最高清晰度」按钮

## 文件结构

```
bilibili-auto-quality/
├── manifest.json         # 插件配置文件
├── content.js           # 内容脚本（核心逻辑）
├── popup.html          # 弹窗页面
├── popup.css           # 弹窗样式
├── popup.js            # 弹窗逻辑
├── generate-icons.html # 图标生成器
├── icon16.png          # 16x16 图标
├── icon48.png          # 48x48 图标
├── icon128.png         # 128x128 图标
└── README.md          # 说明文档
```

## 工作原理

1. **页面检测**：插件通过 content script 注入到B站视频页面
2. **播放器监听**：使用 MutationObserver 监听播放器的加载
3. **清晰度识别**：查找所有可用的清晰度选项
4. **智能选择**：
   - 根据用户设置决定是否选择会员清晰度
   - 自动选择数值最高的清晰度选项
   - 跳过"自动"选项
5. **模拟点击**：通过模拟用户交互切换清晰度

## 注意事项

1. **会员清晰度**：如果选择了会员清晰度但账号不是大会员，可能无法正常播放
2. **页面刷新**：部分情况下可能需要刷新页面才能生效
3. **兼容性**：插件基于当前B站播放器结构开发，如果B站更新播放器可能需要更新插件
4. **权限说明**：
   - `storage`：用于保存用户设置
   - `activeTab`：用于获取当前标签页信息
   - `host_permissions`：仅在B站域名下运行

## 故障排除

### 插件不工作？

1. 确认是否在B站视频页面（URL包含 `/video/`）
2. 检查浏览器控制台是否有错误信息
3. 尝试刷新页面
4. 确认插件已启用

### 清晰度选择失败？

1. 检查网络连接是否正常
2. 确认视频是否已开始加载
3. 如果选择会员清晰度，确认账号是否为大会员
4. 尝试手动点击插件图标中的「立即选择最高清晰度」

### 如何查看运行日志？

1. 在视频页面按 F12 打开开发者工具
2. 切换到 Console（控制台）标签
3. 查看以「B站自动最高清晰度」开头的日志信息

## 更新日志

### v1.0.0 (2024-01)
- 🎉 首次发布
- ✨ 支持自动选择最高清晰度
- ✨ 支持会员/非会员模式切换
- ✨ 支持手动触发选择
- ✨ 支持视频切换检测

## 开发者信息

本插件使用原生 JavaScript 开发，不依赖任何第三方库。

### 技术栈
- Chrome Extension Manifest V3
- Vanilla JavaScript
- CSS3
- HTML5

### 贡献

欢迎提交 Issue 和 Pull Request！

## 免责声明

1. 本插件仅用于学习交流，请勿用于商业用途
2. 本插件不会收集任何用户数据
3. 使用本插件产生的任何问题由用户自行承担
4. 如有侵权请联系删除

## License

MIT License

---

Made with ❤️ for B站用户
